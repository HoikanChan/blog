---
title: Hybrid APP(H5app)前端脱坑指南
vssue-title: Hybrid APP(H5app)前端脱坑指南
date: 2018-11-08
tags:
  - 大前端
  - hybrid-app
categories: [大前端]
---

[[toc]]

## 隐藏所有 WebView 原生交互（刷新，后退等）存在的坑

- 页面卡死，js 报错，无法刷新，不能重置页面

- 网络不佳，页面渲染过慢，不能通过刷新操作缓解焦虑

## 用 H5 做栈管理的坑

- SPA（VUE 框架）的 router.push 没有对应 pop 操作所以是伪栈，并不能很好的实现页面的顺序进入和倒序返回，需要处理返回操作可能造成的页面循环。

- 系统的返回操作没有映射到 WebView 的 history，导致使用系统返回操作或物理键返回作直接退出 App，方案是监听系统返回操作，将原始操作逻辑停止，用 jsbridge 映射到 h5 的返回操作

- 如果模仿小程序采用多开 WebView 方式（需要原生），需要对 webkit 核有一定了解，栈中的页面被再次唤起可能存在页面停止渲染问题

## 其他坑

- H5 吸底输入框无法被键盘顶起问题，纯 web 可以避免类似交互，或者用原生来实现输入框，钉钉是使用原生做的输入框

- 混合开发看似成本低其实很讲究原生与 H5 的产品策略和视觉策略的搭配，做好了可以使原生和 H5 浑然一体以假乱真，国内的话钉钉这方面走的比较远

## 零原生工程师参与打包提交市场是否可行（使用类 Cordova 工具或框架）

- 机型适配，传感器调用，本地 API 调用，这些都由打包工具或框架完成，工具和框架本身的 Bug 不可预期，机生原生代码可读性为 0，这会让前端工程师陷入窘境

- 安卓市场强制 AndroidQ（未来版本）API 适配，打包工具是否跟得上更新令人堪忧

- 框架工具生成的包是否可以灵活配置签名和选择合适的加固方式都有待验证

- 安卓市场好过审，但是国内主流市场和其他分发渠道众多，任何一个卡住跟安装包本身相关的问题都是 web 前端工程师无法处理的

- App Store 虽然目标聚焦但是审核严苛，大多数过审策略都需要产品和研发共同定制

## 关于 hybrid 混合开发的一些建议

- 如果选择 hybrid 混合开发至少要保留 nav（顶部导航）给产品留下足够的余地（左侧最多交互位，右侧可放三个点来无限扩展）

- hybrid 混合开发原生投入少，但不等于零原生配合，主要优点还是在于发布灵活这块

- 原生导航和 H5 导航并存在视觉和产品逻辑上都会有冲突，只保留原生导航通过视觉处理的方式可以跟 H5 无缝结合，交互逻辑也可以通过桥接打通

- hybrid 混合界面在产品处理上页面层级不要过深，尽量不要超过 3 级，否则真的容易让用户找不到回家的路（和小程序限制层级不同，小程序为了追求体验页面跳转都是用新开 WebView 载入的，为了节省开销所以限制页面层级）

- 混合开发原生和 H5 关系部分要做好产品和视觉手段的处理，找好最佳的平衡点，微信小程序、钉钉和早期的手淘都给出了教科书式的示范

- IOS 提交市场，常规过审原则来说苹果对【用户信息使用】【支付流程】【WebView 使用】和其他企图绕开苹果【支付】【投放】【分发】等自建生态的行为态度比较坚决（一个 WebView 可能一次同时绕开了【支付】【投放】【分发】或许更多，所以对于苹果来说风险颇高）。建议过审策略有原生工程师参与，处理常规过审问题已经是 IOS 工程师主流标配技能

- Android 提交市场，因为市场和分发渠道众多，所以跟踪埋点渠道号和打渠道包要梳理清楚，不确定自助类打包工具是否可完成，后期升级策略也是一大块，建议有原生工程师参与
